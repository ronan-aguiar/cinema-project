{% extends 'bilheteria/base.html' %}

{% block content %}
<div style="display: flex; gap: 30px;">
    <!-- Lateral: Seleção de Sessão -->
    <div style="flex: 1; max-width: 300px;">
        <h3 style="margin-bottom: 20px;">Sessões</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; max-height: 70vh; overflow-y: auto; padding-right: 10px;">
            {% for s in sessoes_lista %}
            <a href="?sessao_id={{ s.id }}" 
               style="padding: 15px; background: {% if s.id == sessao_selecionada.id %}#333{% else %}#1f1f1f{% endif %}; 
                      border-radius: 8px; text-decoration: none; color: white; border: 1px solid {% if s.id == sessao_selecionada.id %}var(--primary){% else %}transparent{% endif %};">
                <div style="font-size: 14px; font-weight: bold;">{{ s.filme.titulo }}</div>
                <div style="font-size: 12px; color: #aaa;">{{ s.horario|date:"d/m - H:i" }}</div>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Principal: Dashboard da Sessão -->
    <div style="flex: 3;">
        {% if sessao_selecionada %}
            <h2 style="margin-bottom: 30px;">Relatório: {{ sessao_selecionada.filme.titulo }} - {{ sessao_selecionada.horario|date:"H:i" }} ({{ sessao_selecionada.horario|date:"d/m" }})</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
                <div style="background: #1f1f1f; padding: 25px; border-radius: 8px; border-left: 4px solid #2ecc71;">
                    <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">Receita da Sessão</div>
                    <div style="font-size: 28px; font-weight: bold;">R$ {{ metricas.resumo.total_receita|default:0|stringformat:".2f" }}</div>
                </div>
                <div style="background: #1f1f1f; padding: 25px; border-radius: 8px; border-left: 4px solid var(--primary);">
                    <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">Total Ingressos</div>
                    <div style="font-size: 28px; font-weight: bold;">{{ metricas.resumo.total_qtd }}</div>
                </div>
                <div style="background: #1f1f1f; padding: 20px; border-radius: 8px;">
                    <div style="color: #aaa; font-size: 13px;">Inteiras: <strong style="color: #2ecc71;">{{ metricas.resumo.qtd_inteira }}</strong></div>
                    <div style="color: #aaa; font-size: 13px;">Meias: <strong style="color: #f1c40f;">{{ metricas.resumo.qtd_meia }}</strong></div>
                </div>
            </div>

            <!-- Vendedores na Sessão -->
            <div style="background: #1f1f1f; padding: 20px; border-radius: 8px;">
                <h3 style="margin-bottom: 20px;">Vendas por Funcionário nesta Sessão</h3>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="text-align: left; border-bottom: 1px solid #333;">
                        <tr>
                            <th style="padding: 10px 0;">Funcionário</th>
                            <th>Qtd</th>
                            <th style="text-align: right;">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for v in metricas.vendedores %}
                        <tr style="border-bottom: 1px solid #2a2a2a;">
                            <td style="padding: 12px 0;">{{ v.username }}</td>
                            <td>{{ v.qtd }}</td>
                            <td style="text-align: right;">R$ {{ v.total|stringformat:".2f" }}</td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="3" style="text-align: center; padding: 20px; color: #666;">Nenhuma venda registrada para esta sessão.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div style="text-align: center; padding: 100px 20px; background: #1f1f1f; border-radius: 8px; color: #666;">
                <div style="font-size: 50px; margin-bottom: 20px;"></div>
                <h3>Selecione uma sessão à esquerda para ver os detalhes das vendas.</h3>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
